steps:

- id: 'build prod app'
  name: 'gcr.io/cloud-builders/docker'
  args: [
    'build', 
    '-f', 
    'Dockerfile.alpine', 
    '--tag=gcr.io/$PROJECT_ID/demo-app:latest', 
    '.'
  ]
  waitFor: ['-']

- id: 'push app'
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/demo-app:latest']
  waitFor: ['build prod app']

- id: 'deploy container image to GKE'
  name: "gcr.io/cloud-builders/gke-deploy"
  args: 
  - run
  - --filename=kubernetes.yaml
  - --image=gcr.io/$PROJECT_ID/demo-app:latest
  - --location=us-central1-a
  - --cluster=rims-cluster
  waitFor: ['push app']
  

  