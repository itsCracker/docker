steps:

- id: 'build prod app'
  name: 'gcr.io/cloud-builders/docker'
  args: [
    'build',
    '--tag=gcr.io/$PROJECT_ID/demo-app',
    '--cache-from=gcr.io/$PROJECT_ID/demo-app:latest',
    '.',
  ]
  waitFor: ['-']

- id: 'push app'
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/demo-app:latest']
  waitFor: ['build prod app']

- id: 'deploy container image to GKE'
  name: "gcr.io/cloud-builders/gke-deploy"
  args: 
  - run
  - --image=gcr.io/$PROJECT_ID/demo-app:latest
  - --location=us-central1-a
  - --cluster=demo-app
  

  